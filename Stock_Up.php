<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <style>
            body {background-color:lightgray}
            h1   {color:steelblue; padding-top: 10px; text-align: center;}
            p    {color:black;}
            ul {
                    float: left;
                    width: 100%;
                    padding: 0;
                    margin: 0;
                    list-style-type: none;
                }
                /*BENS CSS*/

                   body {background-color:white}
            h1   {color:steelblue; padding-top: 10px; text-align: center;}
            p    {color:black; font-size="9";}
            ul {
                    float: left;
                    width: 100%;
                    padding: 0;
                    margin: 0;
                    list-style-type: none;
                }

            a {
                    
                    float: right;
                    width: 0;
                    text-decoration: none;
                    color: white;
                    background-color: none;
                    padding: 0 0;
                    border-right: 0 solid white;
                
                }

                div a:hover {
                    background-color: none;
                }
                a:hover {
                  background-color:none;
                }
                div a {
                    float: left;
                    width: 13em;
                    text-decoration: none;
                    color: white;
                    background-color: none;
                    padding: 0 0;
                    border-right: 0 solid white;
                }
                                                                                                                                                                                                                                                                                                                                                                                                           
                li {
                    display: inline;
                }
                 #banner {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: 500px;
                z-index: -1;
            }
                
                #menu {padding-left : 0;float:left;}
                
                form {
                width: 232px;
                margin: 0;
                float: right;
                display: inline;
                }
                .search {
                padding: 0 0;
                background: rgba(50, 50, 50, 0.2);
                border: 0px solid #dbd
                bdb;
                float: right;
                display: inline;
                }
                .button {
                position: relative;
                padding: 3px 10px;
                right: 0;
                border: 2px solid #207cca;
                background-color: #207cca;
                color: #fafafa;
                float: right;
                display: inline;
                }

                #menu:hover {
                  background-color:steelblue;
                }

                .button:hover  {
                background-color:none;
                color:#207cca;
                }

                #tfheader {float: right;}

                
                #footer {
                background-color:black;
                p style="color:red";
                color:white;
                text-align:center;
                padding: 5px;              
                }

                /*BEN*/

            a {
                    float: left;
                    width: 9em;
                    text-decoration: none;
                    color: white;
                    background-color: none;
                    padding: 0 0;
                    border-right: 0 solid white;
                }

                a:hover {
                    background-color: none;
                }
                                                                                                                                                                                                                                                                                                                                                                                                           
                li {
                    display: inline;
                }
                 #banner {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                width: 100%;
                height: 1000px;
                z-index: -1;
            }
                #tfheader {float: right;}
                #menu {padding-left : 0;float:left;}
                
                form {
                width: 232px;
                margin: 0;
                float: right;
                display: inline;
                }
                .search {
                padding: 0 0;
                background: rgba(50, 50, 50, 0.2);
                border: 0px solid #dbdbdb;
                float: right;
                display: inline;
                }
                .button {
                position: relative;
                padding: 3px 15px;
                left: 0;
                border: 2px solid #207cca;
                background-color: #207cca;
                color: #fafafa;
                float: right;
                display: inline;
                }
                .button:hover  {
                background-color:#fafafa;
                color:#207cca;
                }

            /*CSS for the bivariate chart*/

            /*CSS for multi series line chart*/
            body {
                font: 10px sans-serif;
            }

            .axis path,
            .axis line {
                fill: none;
                stroke: steelblue;
                shape-rendering: crispEdges;
                }

            .x.axis path {
                display: none;
                }

                .line {
                    fill: none;
                    stroke: steelblue;
                    stroke-width: 1.5px;
                }

                body {
                    font: 10px sans-serif;
            }

                                        .axis path,
                            .axis line {
                        fill: none;
                        stroke: #000;
                        shape-rendering: crispEdges;
                        }

                .x.axis path {
                    display: none;
                }

                .area {
                fill: steelblue;
                    }

                    body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {
  display: none;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}
        </style>
        <link rel='stylesheet' href='style.css'/>
        <script src='script.js'></script>
    </head>

    <body>


         <!-- HTML for SEARCH BAR -->
  <form method="GET" >
  <input type="text" placeholder="Stock Ticket..." name="stockname" required>
                            
  <a href="#Graphs"><input type="submit" class="button" value="Find"></a>
                            
</form>

   <img id="banner" src="http://i.imgur.com/SkbqTP0.jpg" alt="Banner Image"/>
        
        <ul>
        
        <div id=menu><li><a href="#Graphs"><font size="6">Graphs</font></a></li></div>
        <div id=menu><li><a href="#About"><font size="6">About</font></a></li><div>
        </ul>
       

        <p>&nbsp; 
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp; 
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp; 
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp; 
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp; 
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
            <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;

        

        
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <a name="Graphs"></a>
        <h1 style="font-size:50px">Graphs</h1>
        
        <p>&nbsp;

      

        <form method="GET" >

          <p style="position: relative;
                padding: 3px 15px;
                right: 100px;
                border: 2px solid #207cca;
                
                color: steelblue;
                float: right;
                display: inline;" >Multi-Series Line Chart</p>
          <p style="position: relative;
                
                right: 90px;
                
                
                color: steelblue;
                float: right;
                display: inline;" >(seperate with commas, no spaces)</p>
              
        <input type="text" placeholder="Enter Many Stocks..." name="multiname" required>
        <div><a href="#Graphs"><input type="submit" class="button" value="Find"></a></div>
            
                  <p>&nbsp;
        </form>

        <form method="GET" >

          <p style="position: relative;
                padding: 3px 15px;
                right: 100px;
                border: 2px solid #207cca;
                
                color: steelblue;
                float: right;
                display: inline;" >Bivariate High/Low Area</p>
          <p style="position: relative;
                
                right: 120px;
                
                
                color: steelblue;
                float: right;
                display: inline;" >(enter one ticket symbol)</p>
              
        <input type="text" placeholder="Enter Stock Ticker..." name="stockname" required>
            <div><a href="#Graphs"><input type="submit" class="button" value="Find"></a></div>
                  <p>&nbsp;


          <p style="position: relative;
                padding: 3px 15px;
                right: 100px;
                border: 2px solid #207cca;
                
                color: steelblue;
                float: right;
                display: inline;" >Enter Year To Analyze</p>
        
              
        <input type="text" placeholder="Year" name="date" required>
           
                  <p>&nbsp;
        </form>
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;                  
       
        
        <p>&nbsp;
        <p>&nbsp;
           
        <p>&nbsp; 
        <p>&nbsp;
       
     <p style="font-size:30px; color:steelblue; text-align:center"><?php echo $_GET['stockname']; echo "-";echo $_GET['date']; ?></p>
        <?php
        



  
$dollarVars= "[";
$db_host = 'stockupjames.db.5036399.hostedresource.com';
$db_user = 'stockupjames';
$db_pwd = 'Crimson88!';

$database = 'stocks';
$table = 'price';

$connection = mysqli_connect($db_host, $db_user, $db_pwd, $database, "3336");
if (!$connection)
    die("Can't connect to database" . mysqli_connect_error());

// sending query
if ($_GET['stockname']){
    $sql = "SELECT * FROM {$table} WHERE symbol like '$_GET[stockname]' and date_ex like '%$_GET[date]%' ";
    
    //echo $sql."<br/>";
    $result = mysqli_query($connection, $sql);
    //echo $_GET[stockname];
    if (!$result) {
        die("Query to show fields from table failed");
    }

    $fields_num = mysqli_num_fields($result);
    $numRows = mysqli_num_rows($result);
    //echo "Number of rows $numRows<br/>";

    //echo "<h1>Table: {$table}</h1>";
    //echo "<table border='1'><tr>";
    // printing table headers
    for($i=0; $i<$fields_num; $i++)
    {
        $field = mysqli_fetch_field($result);
        //echo "<td>{$field->name}</td>";
    }
    // echo "</tr >\n";
    // printing table rows
    while($row = mysqli_fetch_row($result))
    {
        echo "<tr>";
       $date= str_replace("-", "", $row[1]);
       $high= $row[3];
       $low= $row[4];
       $dollarVars.="{ date: '" . $date . "', high: ". $high. ", low:". $low."},";
        // $row is array... foreach( .. ) puts every element
        // of $row to $cell variable
         //foreach($row as $cell)
             //echo "<td>$cell</td>";
        
        


        // echo "</tr>\n";
    }
    $dollarVars .= "]";
    $dollarVars = str_replace("},]", "}]", $dollarVars);
    mysqli_free_result($symbol);
}

if ($_GET['multiname'])
{
    $multiname = $_GET['multiname'];
    $stocks = explode(",", $multiname);
    $escaped_stocks = implode("','", $stocks);
    //FIND ME
    $sql = "SELECT * FROM {$table} WHERE symbol in ('$escaped_stocks') ORDER BY date_ex DESC, symbol DESC limit 1500";
    $result = mysqli_query($connection, $sql);
    $stock_name_array = array();
    $dates = array();
    $data = array();

    // foreach($stocks as $name)
    // {
    //     $data[]=array("name" => $name, "values" => array());
    //     $stock_name_array[] = $name;
    // }
        while($row = mysqli_fetch_row($result))
        {
            $name = $row[0];
            // $stock_index = array_search($name, $stock_name_array);
            $date = str_replace("-", "", $row[1]);
            // $dates[] = array('date' => $date);
            $close= $row[5];
            if (!array_key_exists($date, $data)) {
                $data[$date] = array('date' => $date);
            }
            $data[$date][$name] = $close;

            // $data[$stock_index]["values"][]=array('date' => $date, 'close' => $close);
        }
        $data = array_values($data);
    $dollarVars .= "]";
    }

    $json = json_encode($data);
?>
 <!-- Java Script -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
 <script type="text/javascript" src="d3.v2.min.js"></script>
<script>

var margin = {top: 0, right: 20, bottom: 30, left: 50},
    width = 800 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

var parseDate = d3.time.format("%Y%m%d").parse;

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var area = d3.svg.area()
    .x(function(d) { return x(d.date); })
    .y0(function(d) { return y(d.low); })
    .y1(function(d) { return y(d.high); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// d3.tsv("data.tsv", function(error, data) {
//   if (error) throw error;
data = <?php echo $dollarVars; ?>;

  data.forEach(function(d) {
    d.date = parseDate(d.date);
    d.low = +d.low;
    d.high = +d.high;
  });

  x.domain(d3.extent(data, function(d) { return d.date; }));
  y.domain([d3.min(data, function(d) { return d.low; }), d3.max(data, function(d) { return d.high; })]);

  svg.append("path")
      .datum(data)
      .attr("class", "area")
      .attr("d", area);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Stock Price ($)");
// });


// Multi attempt 2
var margin = {top: 20, right: 80, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

var parseDate = d3.time.format("%Y%m%d").parse;

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var color = d3.scale.category10();

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left");

var line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y(d.temperature); });

var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var data = <?php echo json_encode($data); ?>;

  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "date"; }));

  data.forEach(function(d) {
    d.date = parseDate(d.date);
  });

  var cities = color.domain().map(function(name) {
    return {
      name: name,
      values: data.map(function(d) {
        return {date: d.date, temperature: +d[name]};
      })
    };
  });

  x.domain(d3.extent(data, function(d) { return d.date; }));

  y.domain([
    d3.min(cities, function(c) { return d3.min(c.values, function(v) { return v.temperature; }); }),
    d3.max(cities, function(c) { return d3.max(c.values, function(v) { return v.temperature; }); })
  ]);

  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Stock Price ($)");

  var city = svg.selectAll(".city")
      .data(cities)
    .enter().append("g")
      .attr("class", "city");

  city.append("path")
      .attr("class", "line")
      .attr("d", function(d) { return line(d.values); })
      .style("stroke", function(d) { return color(d.name); });

  city.append("text")
      .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
      .attr("transform", function(d) { return "translate(" + x(d.value.date) + "," + y(d.value.temperature) + ")"; })
      .attr("x", 3)
      .attr("dy", ".35em")
      .text(function(d) { return d.name; });

// //Multi series line chart
//     var margin = {top: 20, right: 80, bottom: 30, left: 50},
//     width = 960 - margin.left - margin.right,
//     height = 500 - margin.top - margin.bottom;

// var parseDate = d3.time.format("%Y%m%d").parse;

// var x = d3.time.scale()
//     .range([0, width]);

// var y = d3.scale.linear()
//     .range([height, 0]);

// var color = d3.scale.category10();

// var xAxis = d3.svg.axis()
//     .scale(x)
//     .orient("bottom");

// var yAxis = d3.svg.axis()
//     .scale(y)
//     .orient("left");

// var line = d3.svg.line()
//     .interpolate("basis")
//     .x(function(d) { return x(d.date); })
//     .y(function(d) { return y(d.close); });

// var svg = d3.select("body").append("svg")
//     .attr("width", width + margin.left + margin.right)
//     .attr("height", height + margin.top + margin.bottom)
//   .append("g")
//     .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// //d3.tsv("data.tsv", function(error, data) {}
//   // data = <?php echo $multiname; ?>;

//   data.forEach(function(d) {
//     d.date = parseDate(d.date);
//     d.low = +d.low;
//     d.high = +d.high;
//   });

//   // if (error) throw error;

//   color.domain(<?php echo json_encode($stocks); ?>);

//   data.forEach(function(d) {
//     d.date = parseDate(d.date);
//   });

// var dates = <?php echo json_encode($dates); ?>

// var cities = <?php echo $json; ?>;

//   x.domain(d3.extent(dates, function(d) { return parseDate(d.date); }));

//   y.domain([
//     d3.min(cities, function(c) { return d3.min(c.values, function(v) { return v.close; }); }),
//     d3.max(cities, function(c) { return d3.max(c.values, function(v) { return v.close + 10; }); })
//   ]);

//   svg.append("g")
//       .attr("class", "x axis")
//       .attr("transform", "translate(0," + height + ")")
//       .call(xAxis);

//   svg.append("g")
//       .attr("class", "y axis")
//       .call(yAxis)
//     .append("text")
//       .attr("transform", "rotate(-90)")
//       .attr("y", 6)
//       .attr("dy", ".71em")
//       .style("text-anchor", "end")
//       .text("Multi Stock $");

//   var city = svg.selectAll(".city")
//       .data(cities)
//     .enter().append("g")
//       .attr("class", "city");

//   city.append("path")
//       .attr("class", "line")
//       .attr("d", function(d) { return line(d.values); })
//       .style("stroke", function(d) { return color(d.name); });

//   city.append("text")
//       .datum(function(d) { return {name: d.name, value: d.values[d.values.length - 1]}; })
//       .attr("transform", function(d) { return "translate(" + x(parseDate(d.value.date)) + "," + y(d.value.close) + ")"; })
//       .attr("x", 3)
//       .attr("dy", ".35em")
//       .text(function(d) { return d.name; });


</script>    
     
        <a name="About"></a>
        <h1><font size="12">About</font></h1>
        <p><center><font size="6">Stock Up is a web application that provides stock market data of every company listed on the NYSE, AMEX, and NASDAQ for the last 20 years. The application takes adavantage of the D3 API to present the data in intuitive and pragmatic way.</p>
        <p>We choose to use a multi-series line chart and a bivariate are chart for their A multi-series line chart is a chart using several d3 features that compares several items to each other in the same line graph. A bivariate area chart shows the high and low of an item in a format similar to a line graph with d3 features. </p>
        <p> Made from scratch by a group of high schoolers (James Raubenheimer, Ben Cheng, Jason Kulp, and Kevin Kulp) at B. Reed Henderson High School, the program was designed as part of a challenge intiated by Finicial Industry Regulation Authority (FINRA) during the PennApps 2015 fall competition and was built in 48 hours.</font></center></p>
        <p></p>
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;
        <p>&nbsp;  
        <p>&nbsp;
        <p>&nbsp;
    <div id="footer">
        <p style="color:white"><font size="4"> Designed and built in 48 hours by the B. Reed Henderson High School team at the Pennapps Hackathon</font></p>
    </div>
                            

        
                
    </body>
</html>